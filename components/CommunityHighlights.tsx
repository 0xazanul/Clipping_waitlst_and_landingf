"use client";

import { useState, useEffect } from "react";
import { supabase } from "@/lib/supabase";

export default function CommunityHighlights() {
  const [totalFollowers, setTotalFollowers] = useState<number | null>(null);

  useEffect(() => {
    const fetchTotalFollowers = async () => {
      try {
        if (!supabase) return;

        const { data, error } = await supabase
          .from("waitlist")
          .select("follower_count");

        if (error) {
          console.error("Error fetching follower counts:", error);
          return;
        }

        const total = data?.reduce((sum, row) => {
          const count = parseInt(row.follower_count) || 0;
          return sum + count;
        }, 0) || 0;

        setTotalFollowers(total);
      } catch (err) {
        console.error("Failed to fetch total followers:", err);
      }
    };

    fetchTotalFollowers();
  }, []);

  const formatFollowerCount = (count: number) => {
    if (count >= 1000000) {
      return `${(count / 1000000).toFixed(1)}M`;
    } else if (count >= 1000) {
      return `${(count / 1000).toFixed(1)}K`;
    }
    return count.toString();
  };

  const avatars = [
    { id: 1, src: "https://avatars.githubusercontent.com/u/16860528", position: "top-[8%] left-[8%] sm:top-[10%] sm:left-[15%]" },
    { id: 2, src: "https://avatars.githubusercontent.com/u/20110627", position: "top-[6%] left-[42%] sm:top-[8%] sm:left-[45%]" },
    { id: 3, src: "https://avatars.githubusercontent.com/u/106103625", position: "top-[10%] right-[12%] sm:top-[12%] sm:right-[20%]" },
    { id: 4, src: "https://avatars.githubusercontent.com/u/59228569", position: "top-[32%] right-[5%] sm:top-[35%] sm:right-[8%]" },
    { id: 5, src: "https://avatars.githubusercontent.com/u/59442788", position: "top-[38%] right-[30%] sm:top-[40%] sm:right-[35%]" },
    { id: 6, src: "https://avatars.githubusercontent.com/u/89768406", position: "bottom-[32%] left-[8%] sm:bottom-[35%] sm:left-[12%]" },
  ];

  const logos = [
    { 
      id: 1, 
      icon: "M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z",
      position: "top-[18%] left-[12%] sm:top-[20%] sm:left-[18%]",
      bgColor: "bg-red-500/10"
    },
    { 
      id: 2, 
      icon: "M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z",
      position: "top-[48%] left-[25%] sm:top-[50%] sm:left-[30%]",
      bgColor: "bg-gradient-to-br from-purple-500/10 via-pink-500/10 to-orange-500/10"
    },
    { 
      id: 3, 
      icon: "M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z",
      position: "top-[28%] right-[18%] sm:top-[30%] sm:right-[22%]",
      bgColor: "bg-cyan-500/10"
    },
    { 
      id: 4, 
      icon: "M12.206 2.013C7.082 1.907 2.425 5.491 1.452 10.61c-.927 4.872 1.488 9.834 5.952 12.246 4.237 2.291 9.591 1.511 13.077-1.906 3.486-3.417 4.248-8.772 1.865-13.096-2.326-4.22-7.244-6.476-12.14-5.573.046.078.092.155.137.234-.785.068-1.576.082-2.347.27-.88.215-1.715.602-2.453 1.134-.56.403-1.044.91-1.424 1.49-.38.58-.645 1.225-.776 1.903-.13.679-.122 1.377.025 2.05.146.673.436 1.31.848 1.86.413.55.956.998 1.577 1.31.622.312 1.31.482 2.006.495.696.014 1.39-.14 2.024-.449.634-.31 1.194-.77 1.633-1.342.44-.573.75-1.24.905-1.947.154-.707.15-1.44-.014-2.145-.163-.704-.491-1.363-.956-1.922-.466-.56-1.064-1.004-1.743-1.295.074-.223.156-.444.24-.663.926.31 1.79.803 2.526 1.444.736.64 1.333 1.417 1.747 2.278.414.86.638 1.79.658 2.734.02.943-.157 1.88-.523 2.746-.365.866-.907 1.648-1.587 2.294-.68.646-1.492 1.145-2.382 1.464-.89.319-1.844.45-2.797.385-.953-.065-1.893-.32-2.761-.752-.868-.432-1.644-1.036-2.278-1.772-.635-.736-1.118-1.592-1.418-2.51-.3-.919-.414-1.884-.333-2.841.08-.957.353-1.891.803-2.746.45-.855 1.068-1.622 1.816-2.254.748-.632 1.615-1.124 2.548-1.447.932-.323 1.918-.473 2.901-.44.982.033 1.948.233 2.854.588.906.355 1.742.861 2.467 1.492.725.632 1.33 1.38 1.785 2.203.455.823.753 1.71.873 2.624.12.913.058 1.837-.182 2.717-.24.879-.633 1.7-1.156 2.424-.523.723-1.17 1.338-1.906 1.809-.737.471-1.553.794-2.408.949-.854.155-1.733.141-2.585-.04-.852-.182-1.666-.527-2.404-1.018-.738-.491-1.391-1.124-1.93-1.867-.538-.743-.956-1.585-1.233-2.48-.277-.895-.41-1.829-.394-2.764.016-.935.184-1.86.496-2.726.312-.866.772-1.66 1.354-2.338.583-.677 1.28-1.232 2.053-1.632.773-.4 1.612-.644 2.471-.719.86-.075 1.728-.014 2.558.182.83.195 1.61.542 2.3 1.018.69.476 1.28 1.078 1.74 1.776.46.698.787 1.48.963 2.303.177.823.2 1.672.069 2.502-.131.829-.423 1.623-.859 2.336-.437.713-1.012 1.332-1.697 1.822-.685.49-1.47.842-2.311 1.035-.841.193-1.723.222-2.598.085.024-.086.049-.173.074-.259.825.074 1.657.015 2.456-.175.799-.19 1.55-.527 2.216-.993.666-.466 1.233-1.058 1.673-1.746.44-.688.745-1.463.898-2.285.154-.822.151-1.677-.006-2.498-.157-.82-.462-1.594-.899-2.277-.437-.683-.997-1.263-1.653-1.71-.656-.447-1.399-.755-2.192-.906-.793-.151-1.62-.142-2.434.027-.813.17-1.595.498-2.305.968-.71.47-1.335 1.073-1.842 1.776-.507.703-.889 1.498-1.124 2.344-.235.846-.318 1.731-.243 2.605.075.874.307 1.726.683 2.508.376.782.892 1.478 1.523 2.053.631.575 1.368 1.023 2.174 1.319.806.296 1.669.436 2.537.413.868-.023 1.722-.207 2.522-.542.8-.335 1.533-.818 2.163-1.423.63-.605 1.148-1.326 1.527-2.126.379-.8.614-1.667.694-2.553.08-.886-.004-1.778-.248-2.624-.244-.846-.639-1.634-1.167-2.32-.528-.686-1.18-1.26-1.925-1.692-.744-.432-1.57-.715-2.438-.835-.867-.12-1.763-.074-2.638.135-.875.209-1.716.582-2.478 1.097-.762.515-1.434 1.166-1.981 1.92-.547.754-.965 1.603-1.232 2.502-.267.9-.382 1.839-.338 2.775.044.936.235 1.859.563 2.715.328.856.79 1.635 1.365 2.296.575.661 1.257 1.196 2.01 1.579.753.383 1.568.61 2.405.669.837.059 1.682-.044 2.489-.303.807-.259 1.566-.665 2.238-1.197.672-.532 1.248-1.183 1.7-1.918.452-.735.776-1.544.955-2.386.179-.842.211-1.705.094-2.546-.117-.841-.389-1.65-.803-2.383-.414-.733-.966-1.382-1.626-1.914-.66-.532-1.419-.938-2.238-1.196-.819-.258-1.686-.363-2.558-.309.018-.088.038-.177.059-.265.923-.031 1.847.093 2.726.369.879.276 1.704.696 2.434 1.239.73.543 1.357 1.205 1.848 1.955.491.75.84 1.578 1.029 2.44.189.862.217 1.746.081 2.605-.136.859-.426 1.682-.855 2.425-.429.743-.996 1.397-1.67 1.928-.674.531-1.447.932-2.278 1.181-.831.249-1.707.344-2.582.279-.875-.065-1.737-.29-2.54-.663-.803-.373-1.537-.892-2.166-1.532-.629-.64-1.145-1.393-1.523-2.22-.378-.827-.613-1.718-.692-2.625-.079-.907.01-1.82.263-2.684.253-.864.662-1.667 1.206-2.365.544-.698 1.218-1.283 1.986-1.724.768-.441 1.619-.73 2.508-.85.889-.12 1.802-.069 2.691.15.889.219 1.744.595 2.521 1.108.777.513 1.467 1.156 2.037 1.895.57.739 1.014 1.566 1.308 2.443.294.877.434 1.794.412 2.709-.022.915-.208 1.817-.548 2.655-.34.838-.826 1.6-1.435 2.246-.609.646-1.334 1.167-2.14 1.535-.806.368-1.681.578-2.58.618-.899.04-1.809-.088-2.68-.377-.871-.289-1.693-.73-2.424-1.301-.731-.571-1.362-1.266-1.861-2.049-.499-.783-.859-1.643-1.062-2.533-.203-.89-.247-1.798-.13-2.683.117-.885.391-1.736.807-2.511.416-.775.967-1.464 1.625-2.033.658-.569 1.413-1.012 2.228-1.306.815-.294 1.679-.436 2.546-.418-.011.089-.021.178-.03.268-.82-.002-1.636.133-2.406.398-.77.265-1.483.657-2.106 1.157-.623.5-1.149 1.103-1.555 1.781-.406.678-.686 1.421-.826 2.192-.14.771-.14 1.56 0 2.331.14.771.42 1.514.826 2.192.406.678.932 1.281 1.555 1.781.623.5 1.336.892 2.106 1.157.77.265 1.586.4 2.406.398.009.09.019.179.03.268-.867.018-1.731-.116-2.546-.398-.815-.282-1.57-.713-2.228-1.27-.658-.557-1.209-1.234-1.625-1.999-.416-.765-.69-1.606-.807-2.482-.117-.876-.073-1.775.13-2.657.203-.882.563-1.735 1.062-2.511.499-.776 1.13-1.464 1.861-2.029.731-.565 1.553-.999 2.424-1.283.871-.284 1.781-.415 2.68-.387.899.028 1.774.225 2.58.581.806.356 1.531.867 2.14 1.504.609.637 1.095 1.391 1.435 2.22.34.829.526 1.722.548 2.628.022.906-.118 1.814-.412 2.682-.294.868-.738 1.688-1.308 2.42-.57.732-1.26 1.367-2.037 1.873-.777.506-1.632.876-2.521 1.091-.889.215-1.802.272-2.691.169-.889-.103-1.74-.362-2.508-.762-.768-.4-1.442-.941-1.986-1.594-.544-.653-.953-1.411-1.206-2.234-.253-.823-.342-1.691-.263-2.546.079-.855.314-1.693.692-2.471.378-.778.894-1.478 1.523-2.064.629-.586 1.363-1.053 2.166-1.375.803-.322 1.665-.495 2.54-.509.875-.014 1.751.127 2.582.417.831.29 1.604.73 2.278 1.296.674.566 1.241 1.254 1.67 2.029.429.775.719 1.628.855 2.518.136.89.108 1.805-.081 2.697-.189.892-.538 1.75-1.029 2.53-.491.78-1.118 1.472-1.848 2.044-.73.572-1.555 1.018-2.434 1.317-.879.299-1.803.447-2.726.437-.021.089-.041.178-.059.267.872.056 1.739-.03 2.558-.256.819-.226 1.578-.594 2.238-1.084.66-.49 1.212-1.096 1.626-1.786.414-.69.686-1.455.803-2.252.117-.797.085-1.607-.094-2.394-.179-.787-.503-1.541-.955-2.222-.452-.681-1.028-1.281-1.7-1.771-.672-.49-1.431-.859-2.238-1.087-.807-.228-1.652-.311-2.489-.244-.837.067-1.652.308-2.405.71-.753.402-1.435.957-2.01 1.636-.575.679-1.037 1.475-1.365 2.346-.328.871-.519 1.805-.563 2.751-.044.946.071 1.896.338 2.805.267.909.685 1.768 1.232 2.531.547.763 1.219 1.424 1.981 1.95.762.526 1.603.909 2.478 1.128.875.219 1.771.274 2.638.161.868-.113 1.694-.394 2.438-.831.745-.437 1.397-1.017 1.925-1.711.528-.694.923-1.491 1.167-2.347.244-.856.328-1.757.248-2.652-.08-.895-.315-1.772-.694-2.581-.379-.809-.897-1.538-1.527-2.151-.63-.613-1.363-1.103-2.163-1.445-.8-.342-1.654-.532-2.522-.559-.868-.027-1.731.101-2.537.377-.806.276-1.543.697-2.174 1.241-.631.544-1.147 1.204-1.523 1.947-.376.743-.608 1.558-.683 2.395-.075.837.008 1.683.243 2.493.235.81.617 1.571 1.124 2.242.507.671 1.132 1.244 1.842 1.688.71.444 1.492.753 2.305.911.813.158 1.641.163 2.434.015.793-.148 1.536-.447 2.192-.882.656-.435 1.216-1.002 1.653-1.673.437-.671.742-1.435.899-2.248.157-.813.16-1.658.006-2.47-.154-.812-.459-1.577-.898-2.253-.44-.676-1.007-1.253-1.673-1.701-.666-.448-1.417-.761-2.216-.923-.799-.162-1.631-.171-2.456-.025-.025-.087-.05-.173-.074-.259.875-.123 1.757-.088 2.598.106.841.194 1.626.547 2.311 1.039.685.492 1.26 1.113 1.697 1.829.437.716.728 1.512.859 2.343.131.831.108 1.681-.069 2.506-.177.825-.503 1.609-.963 2.309-.46.7-1.05 1.304-1.74 1.782-.69.478-1.47.826-2.3 1.023-.83.197-1.698.239-2.558.124-.86-.115-1.698-.388-2.471-.804-.773-.416-1.47-.981-2.053-1.666-.583-.685-1.042-1.485-1.354-2.357-.312-.872-.48-1.803-.496-2.744-.016-.941.117-1.881.394-2.782.277-.901.695-1.749 1.233-2.497.538-.748 1.192-1.384 1.93-1.878.738-.494 1.552-.842 2.404-1.025.852-.183 1.733-.199 2.585-.046.855.153 1.671.474 2.408.944.737.47 1.383 1.083 1.906 1.805.523.722.916 1.542 1.156 2.42.24.878.302 1.8.182 2.712-.12.912-.418 1.798-.873 2.619-.455.821-1.060 1.567-1.785 2.197-.725.63-1.561 1.135-2.467 1.488-.906.353-1.872.551-2.854.582-.983.031-1.969-.119-2.901-.443-.933-.324-1.8-.817-2.548-1.451-.748-.634-1.366-1.402-1.816-2.259-.45-.857-.723-1.793-.803-2.752-.08-.959.033-1.925.333-2.846.3-.921.783-1.779 1.418-2.516.634-.737 1.41-1.342 2.278-1.775.868-.433 1.808-.689 2.761-.755.953-.066 1.907.065 2.797.384.89.319 1.702.817 2.382 1.462.68.645 1.222 1.426 1.587 2.291.366.865.543 1.801.523 2.743-.02.942-.244 1.871-.658 2.73-.414.859-1.011 1.635-1.747 2.274-.736.639-1.600 1.131-2.526 1.44-.084.219-.166.44-.24.662.679-.29 1.277-.732 1.743-1.291.465-.559.793-1.217.956-1.92.164-.704.167-1.436.014-2.143-.154-.707-.465-1.373-.905-1.945-.44-.572-1-.031-1.633-1.34-.634-.309-1.322-.48-2.018-.494-.696-.014-1.385.141-2.006.453-.621.312-1.164.759-1.577 1.309-.412.549-.702 1.185-.848 1.857-.147.672-.155 1.37-.025 2.048.131.678.396 1.322.776 1.902.38.58.864 1.086 1.424 1.488.738.532 1.573.918 2.453 1.133.771.188 1.562.202 2.347.27-.045.078-.091.157-.137.234z",
      position: "bottom-[28%] right-[15%] sm:bottom-[30%] sm:right-[18%]",
      bgColor: "bg-yellow-400/10"
    },
  ];

  return (
    <section className="relative w-full py-12 sm:py-16 md:py-20 lg:py-24 xl:py-28 overflow-hidden">
      {/* Radial Ripple Effect Background */}
      <div className="absolute inset-0 pointer-events-none overflow-hidden">
        {/* Diagonal Spotlight Gradient */}
        <div className="absolute inset-0 bg-gradient-to-br from-white/[0.02] via-transparent to-transparent" />
        
        {/* Single Rotating Radar Line - Positioned lower and contained */}
        <div className="absolute top-[85%] sm:top-[80%] left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-40">
          <div
            className="absolute bottom-0 left-0 origin-bottom animate-radar-sweep will-change-transform"
            style={{
              width: '1.5px',
              height: 'min(40vh, 400px)',
              background: `linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.2) 50%, transparent)`,
              boxShadow: `0 0 10px rgba(255, 255, 255, 0.4), 0 0 20px rgba(255, 255, 255, 0.2)`,
            }}
          />
        </div>
        
        {/* Concentric Ripple Circles - Positioned lower with fade */}
        <div className="absolute top-[85%] sm:top-[80%] left-1/2 -translate-x-1/2 -translate-y-1/2 w-[90vw] sm:w-full max-w-[1000px] h-[90vw] sm:h-[100vw] max-h-[1000px] opacity-50">
          {[...Array(10)].map((_, i) => {
            const baseSize = 120;
            const increment = 80;
            const size = baseSize + (i * increment);
            const opacity = Math.max(0.015, 0.12 - i * 0.012);
            
            return (
              <div
                key={i}
                className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full"
                style={{
                  width: `min(${size}px, ${(size / 1000) * 100}vw)`,
                  height: `min(${size}px, ${(size / 1000) * 100}vw)`,
                  border: `1px solid rgba(255, 255, 255, ${opacity})`,
                  boxShadow: `0 0 ${Math.max(6, 16 - i)}px rgba(255, 255, 255, ${opacity * 0.25})`,
                  maskImage: 'linear-gradient(to bottom, white 0%, white 60%, transparent 100%)',
                  WebkitMaskImage: 'linear-gradient(to bottom, white 0%, white 60%, transparent 100%)',
                }}
              />
            );
          })}
        </div>
        
        {/* Subtle radial gradient overlay - Positioned lower */}
        <div 
          className="absolute top-[85%] sm:top-[80%] left-1/2 -translate-x-1/2 -translate-y-1/2 w-[85vw] sm:w-full max-w-[900px] h-[80vw] sm:h-[85vw] max-h-[900px] opacity-30"
          style={{
            background: 'radial-gradient(circle, rgba(255,255,255,0.025) 0%, transparent 65%)',
          }}
        />
      </div>
      
      {/* Content Container */}
      <div className="relative w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 z-10">
        <div className="relative">
          {/* Text Content - Clean spacing */}
          <div className="relative text-center space-y-3 sm:space-y-4 md:space-y-5">
            {/* Section Label */}
            <div className="flex items-center justify-center gap-3 mb-4">
              <div className="h-px w-8 bg-gradient-to-r from-transparent to-orange-500/30" />
              <span className="text-xs font-medium tracking-[0.2em] uppercase text-orange-400/60">
                The Clipping Company
              </span>
              <div className="h-px w-8 bg-gradient-to-l from-transparent to-orange-500/30" />
            </div>
            
            <h2 className="text-xl xs:text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-light text-white/95 tracking-tight leading-tight px-4 sm:px-6 md:px-0 max-w-3xl mx-auto">
              Supercharge your company with a strong community of content creators and their <br></br> {" "}
              {totalFollowers !== null && (
                <>
                  <span className="text-orange-400 font-medium">
                    {totalFollowers.toLocaleString()}+
                  </span>{" "}
                 followers.
                </>
              )}
              {totalFollowers === null && "community of"}
              <br className="hidden xs:block" />
            
            </h2>
          </div>

          {/* Avatar and Logo Grid - Proper containment */}
          <div className="relative mt-8 sm:mt-10 md:mt-12 lg:mt-14 h-48 xs:h-56 sm:h-64 md:h-72 lg:h-80 max-w-5xl mx-auto">
            {avatars.map((avatar) => (
              <div
                key={avatar.id}
                className={`absolute ${avatar.position} w-10 h-10 xs:w-11 xs:h-11 sm:w-13 sm:h-13 md:w-14 md:h-14 lg:w-15 lg:h-15 rounded-full overflow-hidden border-[1.5px] sm:border-2 border-white/[0.15] backdrop-blur-sm bg-black/20 transition-all duration-300 hover:scale-110 hover:border-white/40 hover:shadow-[0_0_20px_rgba(255,255,255,0.2)] animate-float`}
              >
                <img
                  src={avatar.src}
                  alt={`Community member ${avatar.id}`}
                  className="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
            ))}

            {logos.map((logo) => (
              <div
                key={logo.id}
                className={`absolute ${logo.position} w-9 h-9 xs:w-10 xs:h-10 sm:w-11 sm:h-11 md:w-12 md:h-12 lg:w-13 lg:h-13 rounded-xl sm:rounded-2xl ${logo.bgColor} border border-white/[0.12] backdrop-blur-sm flex items-center justify-center transition-all duration-300 hover:scale-110 hover:border-white/30 hover:shadow-[0_0_20px_rgba(255,255,255,0.15)] animate-float`}
              >
                <svg
                  className="w-4.5 h-4.5 xs:w-5 xs:h-5 sm:w-5.5 sm:h-5.5 md:w-6 md:h-6 lg:w-6.5 lg:h-6.5 text-white/70"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d={logo.icon} />
                </svg>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}
